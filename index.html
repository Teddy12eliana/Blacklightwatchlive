<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blacklight Watch — Global Live Intelligence</title>
  <meta name="description" content="Health • Conflict • Economy • Tech • Trafficking — Live verified global intelligence updates." />
  <link rel="stylesheet" href="assets/style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
</head>

<body class="intro-on">
  <!-- Intro splash -->
  <div class="intro" id="intro">
    <h1 class="intro-title">BLACKLIGHT <span>WATCH</span></h1>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand"><strong>Blacklight</strong> <span>Watch</span></div>
    <nav>
      <a class="active" data-tab="feed">Feed</a>
      <a data-tab="map">Map</a>
      <a data-tab="insights">Insights</a>
      <a data-tab="about">About</a>
    </nav>
    <div class="sidebar-actions">
      <a class="button ghost" href="pricing.html">Pro / Pricing</a>
      <a class="button ghost" href="login.html">Secure Access</a>
      <button id="openSettings" class="button">Settings</button>
    </div>
  </aside>

  <!-- Main -->
  <main class="main fade-in">
    <!-- CINEMATIC HERO -->
    <section class="hero">
      <div class="hero-bg"></div>
      <div class="hero-glow"></div>
      <div class="hero-content">
        <h1>Global Live Intelligence</h1>
        <p class="sub">Health • Conflict • Economy • Tech • Trafficking</p>
        <span id="supabaseBadge" class="pill">Connecting…</span>

        <div class="chip-row" aria-hidden="true">
          <span class="chip">WHO</span>
          <span class="chip">IMF</span>
          <span class="chip">UN</span>
          <span class="chip">ACLED</span>
          <span class="chip">Sat Feeds</span>
          <span class="chip">Local Voices</span>
        </div>
      </div>
    </section>

    <!-- AI PREDICTIONS -->
  <section class="panel">
  <h2>AI Predictions (Live)</h2>
  <p class="muted">Auto-updated every few hours. Pro & Analyst tiers unlock history and alerting.</p>
  <p id="predictions-timestamp" class="timestamp">Last Updated: —</p>

      <div class="pred-grid" id="predictions">
        <!-- Filled by assets/predictions.js -->
        <div class="pred-card">
          <h4>Conflict Risk</h4>
          <div class="meter" data-key="conflict_risk"><span></span></div>
          <p class="pred-note" data-key="conflict_note">Loading…</p>
        </div>
        <div class="pred-card">
          <h4>Health Outbreak Risk</h4>
          <div class="meter" data-key="health_risk"><span></span></div>
          <p class="pred-note" data-key="health_note">Loading…</p>
        </div>
        <div class="pred-card">
          <h4>Economic Sentiment</h4>
          <div class="meter" data-key="economy_sentiment"><span></span></div>
          <p class="pred-note" data-key="economy_note">Loading…</p>
        </div>
        <div class="pred-card">
          <h4>Investor Signals</h4>
          <div class="meter" data-key="investor_signal"><span></span></div>
          <p class="pred-note" data-key="investor_note">Loading…</p>
        </div>
      </div>
    </section>

    <!-- FEED -->
    <section class="panel">
      <h2>Latest Reports</h2>
      <div class="reports-container"><p>Loading reports...</p></div>
    </section>

    <section class="panel">
      <h2>Module Freshness</h2>
      <p class="muted">No status yet.</p>
    </section>

    <section class="panel">
      <h2>Live Map</h2>
      <div style="height:420px;border:1px solid #222;border-radius:12px;background:#0f0f0f;"></div>
    </section>

    <section class="panel">
      <h2>Risk & Trend Radar (Preview)</h2>
      <p>Coming next: adjustable radius, update cadence, and 3–12 month outlook.</p>
    </section>

    <section class="panel">
      <h2>About</h2>
      <p>Neutral, verified signals. Voices allowed, propaganda filtered. Built for citizens, analysts, and responders.</p>
    </section>
  </main>

  <!-- Pull live env from Netlify -->
  <script>
    window.__envPromise = (async () => {
      try {
        const res = await fetch('https://blacklightwatchlive1k.netlify.app/.netlify/functions/env', { cache: 'no-store' });
        const env = await res.json();
        window.VITE_SUPABASE_URL = env.VITE_SUPABASE_URL;
        window.VITE_SUPABASE_ANON_KEY = env.VITE_SUPABASE_ANON_KEY;
        console.log("✅ Loaded live environment:", window.VITE_SUPABASE_URL);
        return env;
      } catch (err) {
        console.error("⚠️ Could not load env from Netlify:", err);
        return {};
      }
    })();

    // little intro fade
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.body.classList.remove('intro-on');
        const intro = document.getElementById('intro');
        if (intro) intro.remove();
      }, 900);
    });
  </script>

  <!-- Load modules after env -->
  <script type="module">
    await window.__envPromise;
    import { fetchReports } from './assets/supabase.js';
    import { loadPredictions } from './assets/predictions.js';

    // Reports
    (async function loadReports() {
      const reports = await fetchReports();
      const container = document.querySelector('.reports-container');
      if (!container) return;
      if (!reports.length) { container.innerHTML = '<p>No recent reports found.</p>'; return; }
      container.innerHTML = reports.map(r => `
        <div class="report-item">
          <h4>${r.title || 'Untitled Report'}</h4>
          <p>${r.summary || 'No summary available.'}</p>
          <span>${new Date(r.created_at).toLocaleString()}</span>
        </div>
      `).join('');
    })();

    // Predictions
    loadPredictions();
  </script>
</body>
</html>
