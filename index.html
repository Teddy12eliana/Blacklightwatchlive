<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ‚úÖ Character encoding & viewport -->
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ‚úÖ SEO & title -->
  <title>Blacklight Watch ‚Äî Global Live Intelligence</title>
  <meta name="description" content="Health ‚Ä¢ Conflict ‚Ä¢ Economy ‚Ä¢ Tech ‚Ä¢ Trafficking ‚Äî Live verified global intelligence updates." />

  <!-- ‚úÖ Styles -->
  <link rel="stylesheet" href="assets/style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />

  <!-- ‚úÖ Safe Supabase injection block -->
  <script>
    // Try to use Netlify‚Äôs injected environment variables
    window.VITE_SUPABASE_URL = window.VITE_SUPABASE_URL || "{{VITE_SUPABASE_URL}}";
    window.VITE_SUPABASE_ANON_KEY = window.VITE_SUPABASE_ANON_KEY || "{{VITE_SUPABASE_ANON_KEY}}";

    // ‚úÖ Fallback if Netlify didn‚Äôt inject anything (prevents old URL/key)
    if (!window.VITE_SUPABASE_URL || window.VITE_SUPABASE_URL.includes("{{VITE_SUPABASE_URL}}")) {
      window.VITE_SUPABASE_URL = "https://cfdgliylbyozaajfpyhe.supabase.co"; // ‚úÖ your real Supabase URL
    }

    if (!window.VITE_SUPABASE_ANON_KEY || window.VITE_SUPABASE_ANON_KEY.includes("{{VITE_SUPABASE_ANON_KEY}}")) {
      window.VITE_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmZGdsaXlsYnlvemFhamZweWhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzMzczNjMsImV4cCI6MjA3NjkxMzM2M30.tHJLV1TJkdhp-63Fe9RBIuyB1G5JGHZ3TmrxBRzdmjA"; // ‚úÖ replace with your anon key
    }

    console.log("‚úÖ Injected Supabase URL:", window.VITE_SUPABASE_URL);
  </script>
</head>

<body class="intro-on">
  <div class="intro" id="intro">
    <h1 class="intro-title">BLACKLIGHT <span>WATCH</span></h1>
  </div>

  <aside class="sidebar">
    <div class="brand">
      <strong>Blacklight</strong> <span>Watch</span>
    </div>
    <nav>
      <a class="active" data-tab="feed">Feed</a>
      <a data-tab="map">Map</a>
      <a data-tab="insights">Insights</a>
      <a data-tab="about">About</a>
    </nav>
    <div class="sidebar-actions">
      <a class="button ghost" href="pricing.html">Pro / Pricing</a>
      <a class="button ghost" href="login.html">Secure Access</a>
      <button id="openSettings" class="button">Settings</button>
    </div>
  </aside>

    <main class="main fade-in">
    <header class="page-header">
      <h1>Global Live Intelligence</h1>
      <p class="sub">Health ‚Ä¢ Conflict ‚Ä¢ Economy ‚Ä¢ Tech ‚Ä¢ Trafficking</p>
      <span id="supabaseBadge" class="pill">Connecting‚Ä¶</span>
    </header>

    <section>
      <h2>Latest Reports</h2>
      <div class="reports-container">
        <p>Loading reports...</p>
      </div>
    </section>

    <section>
      <h2>Module Freshness</h2>
      <p>No status yet.</p>
    </section>

    <section>
      <h2>Live Map</h2>
      <div style="height:420px;border:1px solid #222;border-radius:12px;background:#0f0f0f;">
        <!-- Map placeholder -->
      </div>
    </section>

    <section>
      <h2>Risk & Trend Radar (Preview)</h2>
      <p>Coming next: adjustable radius, update cadence, and 3‚Äì12 month outlook.</p>
    </section>

    <section>
      <h2>About</h2>
      <p>Neutral, verified signals. Voices allowed, propaganda filtered. Built for citizens, analysts, and responders.</p>
    </section>
  </main>

  <!-- üü¢ 1Ô∏è‚É£ Fetch environment vars from Netlify function (runtime safe) -->
  <script>
    window.__envPromise = (async () => {
      try {
        const res = await fetch('/.netlify/functions/env', { cache: 'no-store' });
        const env = await res.json();

        // ‚úÖ Inject live envs
        window.VITE_SUPABASE_URL = env.VITE_SUPABASE_URL || "https://cfdgliylbyozaajfpyhe.supabase.co";
        window.VITE_SUPABASE_ANON_KEY = env.VITE_SUPABASE_ANON_KEY || "YOUR_SUPABASE_ANON_KEY_HERE";

        console.log("‚úÖ Loaded live environment from Netlify:", window.VITE_SUPABASE_URL);
        return env;
      } catch (err) {
        console.warn("‚ö†Ô∏è Could not fetch env from Netlify, using fallback:", err);
        window.VITE_SUPABASE_URL = "https://cfdgliylbyozaajfpyhe.supabase.co";
        window.VITE_SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY_HERE";
        return {};
      }
    })();
  </script>

  <!-- üü¢ 2Ô∏è‚É£ Load reports after environment is available -->
  <script type="module">
    // Wait for env promise to finish
    await window.__envPromise;

    import { fetchReports } from './assets/supabase.js';

    async function loadReports() {
      const reports = await fetchReports();
      const container = document.querySelector('.reports-container');
      if (!container) return;

      if (!reports.length) {
        container.innerHTML = '<p>No recent reports found.</p>';
        return;
      }

      container.innerHTML = reports
        .map(
          (r) => `
          <div class="report-item">
            <h4>${r.title || 'Untitled Report'}</h4>
            <p>${r.summary || 'No summary available.'}</p>
            <span>${new Date(r.created_at).toLocaleString()}</span>
          </div>
        `
        )
        .join('');
    }

    loadReports();
  </script>
</body>
</html>
